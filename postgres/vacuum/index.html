<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    

    <title>vacuum åƒåœ¾å›æ”¶å™¨ | Let&#39;s go ğŸŒ ğŸŒ ğŸŒ</title>
    <meta property="og:title" content="vacuum åƒåœ¾å›æ”¶å™¨ - Let&#39;s go ğŸŒ ğŸŒ ğŸŒ">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2018-12-05T16:48:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2018-12-05T16:48:00&#43;08:00'>
        
    <meta name="Keywords" content="postgres ã€pythonã€pg ã€linix ã€dockerã€ kubernetesã€ cloudã€hadoopã€promethues ">
    <meta name="description" content="vacuum åƒåœ¾å›æ”¶å™¨">
        
    <meta name="author" content="Eamon">
    <meta property="og:url" content="https://zhangeamon.top/postgres/vacuum/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    
    
    <script type="text/javascript" src="/js/jquery.min.js"></script>
   
    
    
    
    
    
    
        <link rel="stylesheet" href='/css/douban.css'>
    
        <link rel="stylesheet" href='/css/other.css'>
    
   
        <a href=https://github.com/eamonzhang><img style="position: absolute; top: 0; left: 0; border: 0;" src="/images/forkme_left_red_aa0000.png" alt="Fork me on GitHub" data-canonical-src="/images/forkme_left_red_aa0000.png"></a>

   
        <script>
          var _hmt = _hmt || [];
            (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?1f6605a363a50554aa03adcc685b7699";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
          })();
       </script>
</head>

<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://zhangeamon.top">
                        Let&#39;s go ğŸŒ ğŸŒ ğŸŒ
                    </a>
                
                <p class="description">Let&#39;s build our own cloud native together  </p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://zhangeamon.top">é¦–é¡µ</a>
                    
                    <a  href="https://zhangeamon.top/archives" title="å½’æ¡£">å½’æ¡£</a>
                    
                    <a  href="https://zhangeamon.top/postgresql" title="Postgres">Postgres</a>
                    
                    <a  href="https://zhangeamon.top/linux" title="Linux">Linux</a>
                    
                    <a  href="https://zhangeamon.top/about/me" title="å…³äº">å…³äº</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    

    <article class="post">
        <header>
            <h1 class="post-title">vacuum åƒåœ¾å›æ”¶å™¨</h1>
        </header>
        <date class="post-meta meta-date">
            2018å¹´12æœˆ5æ—¥
        </date>
        
        
        
        <div class="post-content">
            <h4 id="ä»‹ç»">ä»‹ç»</h4>
<p>æ•°æ®åº“æ€»æ˜¯ä¸æ–­åœ°åœ¨æ‰§è¡Œåˆ é™¤ï¼Œæ›´æ–°ç­‰æ“ä½œã€‚è‰¯å¥½çš„ç©ºé—´ç®¡ç†éå¸¸é‡è¦ï¼Œèƒ½å¤Ÿå¯¹æ€§èƒ½å¸¦æ¥å¤§å¹…æé«˜ã€‚åœ¨postgresqlä¸­ç”¨äºç»´æŠ¤æ•°æ®åº“ç£ç›˜ç©ºé—´çš„å·¥å…·æ˜¯VACUUMï¼Œå…¶é‡è¦çš„ä½œç”¨æ˜¯åˆ é™¤é‚£äº›å·²ç»æ ‡ç¤ºä¸ºåˆ é™¤çš„æ•°æ®å¹¶é‡Šæ”¾ç©ºé—´ã€‚
postgresqlä¸­æ‰§è¡Œdelete,updateæ“ä½œåï¼Œè¡¨ä¸­çš„è®°å½•åªæ˜¯è¢«æ ‡ç¤ºä¸ºåˆ é™¤çŠ¶æ€ï¼Œå¹¶æ²¡æœ‰é‡Šæ”¾ç©ºé—´ï¼Œåœ¨ä»¥åçš„updateæˆ–insertæ“ä½œä¸­è¯¥éƒ¨åˆ†çš„ç©ºé—´æ˜¯ä¸èƒ½å¤Ÿè¢«é‡ç”¨çš„ã€‚ç»è¿‡vacuumæ¸…ç†åï¼Œç©ºé—´æ‰èƒ½å¾—åˆ°é‡Šæ”¾ã€‚</p>
<h4 id="æ„ä¹‰">æ„ä¹‰</h4>
<p>PostgreSQLæ¯ä¸ªè¡¨å’Œç´¢å¼•çš„æ•°æ®éƒ½æ˜¯ç”±å¾ˆå¤šä¸ªå›ºå®šå°ºå¯¸çš„é¡µé¢å­˜å‚¨ï¼ˆé€šå¸¸æ˜¯ 8kBï¼Œä¸è¿‡åœ¨ç¼–è¯‘æœåŠ¡å™¨æ—¶[â€“with-blocksize]å¯ä»¥é€‰æ‹©å…¶ä»–ä¸åŒçš„å°ºå¯¸ï¼‰</p>
<p>PostgreSQLä¸­æ•°æ®æ“ä½œæ°¸è¿œæ˜¯Appendæ“ä½œ,å…·ä½“å«ä¹‰å¦‚ä¸‹:</p>
<ul>
<li>insert æ—¶å‘é¡µä¸­æ·»åŠ ä¸€æ¡æ•°æ®</li>
<li>update å°†å†å²æ•°æ®æ ‡è®°ä¸ºæ— æ•ˆ,ç„¶åå‘é¡µä¸­æ·»åŠ æ–°æ•°æ®</li>
<li>delete å°†å†å²æ•°æ®æ ‡è®°ä¸ºæ— æ•ˆ</li>
</ul>
<p>å› ä¸ºè¿™ä¸ªç‰¹æ€§,æ‰€ä»¥éœ€è¦å®šæœŸå¯¹æ•°æ®åº“vacuum,å¦åˆ™ä¼šå¯¼è‡´æ•°æ®åº“è†¨èƒ€,å»ºè®®æ‰“å¼€autovacuum.</p>
<h4 id="æ–‡æ³•">æ–‡æ³•</h4>
<pre><code>VACUUM [ ( { FULL | FREEZE | VERBOSE | ANALYZE | DISABLE_PAGE_SKIPPING } [, ...] ) ] [ table_name [ (column_name [, ...] ) ] ]
VACUUM [ FULL ] [ FREEZE ] [ VERBOSE ] [ table_name ]
VACUUM [ FULL ] [ FREEZE ] [ VERBOSE ] ANALYZE [ table_name [ (column_name [, ...] ) ] ]
</code></pre><h4 id="å‚æ•°">å‚æ•°</h4>
<h5 id="full">FULL</h5>
<p>Selects â€œfullâ€ vacuum, which can reclaim more space, but takes much longer and exclusively locks the table. This method also requires extra disk space, since it writes a new copy of the table and doesn&rsquo;t release the old copy until the operation is complete. Usually this should only be used when a significant amount of space needs to be reclaimed from within the table.</p>
<p>å¤§æ‹›ï¼Œéœ€è¦æ›´å¤šçš„ç£ç›˜ç©ºé—´ï¼Œç©ºé—´å°†ä¼šè¢«é‡æ–°æ•´ç†ã€‚ã€€auto vacumm åªåˆ é™¤ç©ºé—´ï¼Œå¹¶æ²¡æœ‰æ•´ç†ä½¿ç©ºé—´æ›´ç´§å‡‘ã€‚</p>
<h5 id="verbose">VERBOSE</h5>
<p>Prints a detailed vacuum activity report for each table.<br>
æ‰“å°å›æ”¶æ—¶æ¯ä¸ªtable æ‰§è¡Œç»†èŠ‚</p>
<h5 id="analyze">ANALYZE</h5>
<p>Updates statistics used by the planner to determine the most efficient way to execute a query.</p>
<p>ç»Ÿè®¡åº“</p>
<h5 id="ä¾‹å­">ä¾‹å­</h5>
<p>å¯ä»¥ç²¾ç¡®æŒ‡å®šéœ€è¦æ‰§è¡Œçš„table, å¦‚æœä¸æŒ‡å®šè¢«å›æ”¶çš„å¯¹è±¡ï¼Œé»˜è®¤ä¸ºå½“å‰database ä¸‹æ‰€æœ‰ table</p>
<pre><code>VACUUM (FULL,VERBOSE, ANALYZE) table_name;
</code></pre><p>å°†æ‰§è¡Œè¿‡ç¨‹ç»†èŠ‚æ‰“å°åˆ°æ–‡ä»¶ä¸­</p>
<pre><code>psql -U user -d database  -c &quot;vacuum FULL VERBOSE ANALYZE table&quot;  &gt; vacuum-01.log 2&gt;&amp;1
</code></pre><h5 id="æµ‹è¯•-vacuum-full">æµ‹è¯• vacuum full</h5>
<p>ctid (0,59) è¡¨ç¤ºæ•°æ®å­˜æ”¾ä½ç½®ä¸ºç¬¬0ä¸ªé¡µé¢çš„ç¬¬59è¡Œ</p>
<p>åˆ›å»ºæµ‹è¯•è¡¨</p>
<pre><code>create table test_vacuum(
    objectid bigserial not null,                --å”¯ä¸€ç¼–å·ï¼Œä¸»é”®
    name text not null,                         --åç§°
    describe text,                              --å¤‡æ³¨
    generate timestamptz default now() not null,--åˆ›å»ºæ—¥æœŸ
    constraint pk_test1_objectid primary key(objectid)
); 
</code></pre><p>åˆ›å»ºéšæœºç”Ÿæˆä¸­æ–‡å­—ç¬¦å‡½æ•°</p>
<pre><code>drop function if exists gen_random_zh(int,int);
create or replace function gen_random_zh(int,int)
    returns text
as $$
	select string_agg(chr((random()*(20901-19968)+19968 )::integer) , '')  from generate_series(1,(random()*($2-$1)+$1)::integer); $$ language sql; 
</code></pre><p>å¯¼å…¥æµ‹è¯•æ•°æ®</p>
<pre><code>insert into test_vacuum(name)
  select gen_random_zh(8,32) from generate_series(1,10000); 
</code></pre><p>æŸ¥çœ‹æ•°æ®å¸ƒå±€</p>
<pre><code>select ctid,objectid from test_vacuum limit 500;
ctid,objectid
--------
 ....
(1,17) 92
(1,18) 93
(1,19) 94
(1,20) 95 
 ....
</code></pre><p>æ›´æ–°è¡¨ä¸­æ•°æ®</p>
<pre><code>update test2 set name=gen_random_zh(8,32) where objectid = 93;
</code></pre><p>æ›´æ–°åè¡¨ä¸­æ•°æ®å¸ƒå±€</p>
<pre><code>select ctid,objectid from test_vacuum limit 500;
ctid,objectid
--------
 ....
(1,17) 92
(1,19) 94
(1,20) 95 
 ....
</code></pre><p>æ‰§è¡Œ vacuum FULL</p>
<pre><code>vacuum FULL test_vacuum

select ctid,objectid from test_vacuum limit 500;
ctid,objectid
--------
 ....
(1,17) 92
(1,18) 94
(1,29) 95 
 ....

</code></pre><p>æ•°æ®å¸ƒå±€å˜çš„æ›´ç´§å‡‘ï¼Œã€€åªæ‰§è¡Œvacuum æ•°æ®ä¸ä¼šç§»åŠ¨</p>
<h4 id="æ‰©å±•é˜…è¯»">æ‰©å±•é˜…è¯»</h4>
<p>1.å›æ”¶ç©ºé—´</p>
<p>è¿™ä¸ªé€šå¸¸æ˜¯å¤§å®¶æœ€å®¹æ˜“æƒ³èµ·æ¥çš„åŠŸèƒ½ã€‚å›æ”¶ç©ºé—´ï¼Œå°†dead tupleæ¸…ç†æ‰ã€‚ä½†æ˜¯å·²ç»åˆ†é…çš„ç©ºé—´ï¼Œä¸€èˆ¬ä¸ä¼šé‡Šæ”¾æ‰ã€‚é™¤éåšvacuum fullï¼Œä½†æ˜¯éœ€è¦exclusive lockã€‚ä¸€èˆ¬ä¸å¤ªå»ºè®®ï¼Œå› ä¸ºå¦‚æœè¡¨æœ€ç»ˆè¿˜æ˜¯ä¼šæ¶¨åˆ°
è¿™ä¸ªé«˜æ°´ä½ä¸Šï¼Œç»å¸¸åšvacuum fullæ„ä¹‰ä¸æ˜¯éå¸¸å¤§ã€‚ä¸€èˆ¬åˆç†è®¾ç½®vacuumå‚æ•°ï¼Œè¿›è¡Œå¸¸è§„vacuumä¹Ÿå°±å¤Ÿäº†ã€‚</p>
<p>2.å†»ç»“tupleçš„xid</p>
<p>PGä¼šåœ¨æ¯æ¡è®°å½•ï¼ˆtupleï¼‰çš„headerä¸­ï¼Œå­˜æ”¾xmin,xmaxä¿¡æ¯(å¢åˆ æ”¹äº‹åŠ¡ID)ã€‚transactionIDçš„æœ€å¤§å€¼ä¸º2çš„32æ¬¡ï¼Œå³æ— ç¬¦æ•´å½¢æ¥è¡¨ç¤ºã€‚å½“transactionIDè¶…è¿‡æ­¤æœ€å¤§å€¼åï¼Œä¼šå¾ªç¯ä½¿ç”¨ã€‚
è¿™ä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šå°±æ˜¯æœ€æ–°äº‹åŠ¡çš„transactionIDä¼šå°äºè€äº‹åŠ¡çš„transactionIDã€‚å¦‚æœè¿™ç§æƒ…å†µå‘ç”Ÿåï¼ŒPGå°±æ²¡æœ‰åŠæ³•æŒ‰transactionIDæ¥åŒºåˆ†äº‹åŠ¡çš„å…ˆåï¼Œä¹Ÿæ²¡æœ‰åŠæ³•å®ç°MVCCäº†ã€‚å› æ­¤PGç”¨vacuumåå°è¿›ç¨‹ï¼Œ
æŒ‰ä¸€å®šçš„å‘¨æœŸå’Œç®—æ³•è§¦å‘vacuumåŠ¨ä½œï¼Œå°†è¿‡è€çš„tupleçš„headerä¸­çš„äº‹åŠ¡IDè¿›è¡Œå†»ç»“ã€‚å†»ç»“äº‹åŠ¡IDï¼Œå³å°†äº‹åŠ¡IDè®¾ç½®ä¸ºâ€œ2â€ï¼ˆâ€œ0â€è¡¨ç¤ºæ— æ•ˆäº‹åŠ¡IDï¼›â€œ1â€è¡¨ç¤ºbootstrapï¼Œå³åˆå§‹åŒ–ï¼›â€œ3â€è¡¨ç¤ºæœ€å°çš„äº‹åŠ¡IDï¼‰ã€‚PGè®¤ä¸ºè¢«å†»ç»“çš„äº‹åŠ¡IDæ¯”ä»»ä½•äº‹åŠ¡éƒ½è¦è€ã€‚è¿™æ ·å°±ä¸ä¼šå‡ºç°ä¸Šé¢çš„è¿™ç§æƒ…å†µäº†ã€‚</p>
<p>3.æ›´æ–°ç»Ÿè®¡ä¿¡æ¯</p>
<p>vacuum analyzeæ—¶ï¼Œä¼šæ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼Œè®©PGçš„plannerèƒ½å¤Ÿç®—å‡ºæ›´å‡†ç¡®çš„æ‰§è¡Œè®¡åˆ’ã€‚autovacuum_analyze_thresholdå’Œautovacuum_analyze_scale_factorå‚æ•°å¯ä»¥æ§åˆ¶analyzeçš„è§¦å‘çš„é¢‘ç‡ã€‚</p>
<p>4.æ›´æ–°visibility map</p>
<p>åœ¨PGä¸­ï¼Œæœ‰ä¸€ä¸ªvisibility mapç”¨æ¥æ ‡è®°é‚£äº›pageä¸­æ˜¯æ²¡æœ‰dead tupleçš„ã€‚è¿™æœ‰ä¸¤ä¸ªå¥½å¤„ï¼Œä¸€æ˜¯å½“vacuumè¿›è¡Œscanæ—¶ï¼Œç›´æ¥å¯ä»¥è·³è¿‡è¿™äº›pageã€‚äºŒæ˜¯è¿›è¡Œindex-only scanæ—¶ï¼Œå¯ä»¥å…ˆæ£€æŸ¥ä¸‹visibility mapã€‚è¿™æ ·å‡å°‘fetch tupleæ—¶çš„å¯è§æ€§åˆ¤æ–­ï¼Œä»è€Œå‡å°‘IOæ“ä½œï¼Œæé«˜æ€§èƒ½ã€‚å¦å¤–visibility mapç›¸å¯¹æ•´ä¸ªrelationï¼Œè¿˜æ˜¯å°å¾ˆå¤šï¼Œå¯ä»¥cacheåˆ°å†…å­˜ä¸­ã€‚</p>
<h4 id="vacuumå‚æ•°ä»‹ç»">vacuumå‚æ•°ä»‹ç»</h4>
<h5 id="autovacuum-è§¦å‘æ¡ä»¶å¤§è‡´æœ‰ä»¥ä¸‹å‡ ä¸ª">autovacuum è§¦å‘æ¡ä»¶ï¼Œå¤§è‡´æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</h5>
<pre><code>autovacuumï¼šé»˜è®¤ä¸ºonï¼Œè¡¨ç¤ºæ˜¯å¦å¼€èµ·autovacuumã€‚é»˜è®¤å¼€èµ·ã€‚ç‰¹åˆ«çš„ï¼Œå½“éœ€è¦å†»ç»“xidæ—¶ï¼Œå°½ç®¡æ­¤å€¼ä¸ºoffï¼ŒPGä¹Ÿä¼šè¿›è¡Œvacuumã€‚
autovacuum_naptimeï¼šä¸‹ä¸€æ¬¡vacuumçš„æ—¶é—´ï¼Œé»˜è®¤1minã€‚ è¿™ä¸ªnaptimeä¼šè¢«vacuum launcheråˆ†é…åˆ°æ¯ä¸ªDBä¸Šã€‚autovacuum_naptime/num of dbã€‚
log_autovacuum_min_durationï¼šè®°å½•autovacuumåŠ¨ä½œåˆ°æ—¥å¿—æ–‡ä»¶ï¼Œå½“vacuumåŠ¨ä½œè¶…è¿‡æ­¤å€¼æ—¶ã€‚ â€œ-1â€è¡¨ç¤ºä¸è®°å½•ã€‚â€œ0â€è¡¨ç¤ºæ¯æ¬¡éƒ½è®°å½•ã€‚
autovacuum_max_workersï¼šæœ€å¤§åŒæ—¶è¿è¡Œçš„workeræ•°é‡ï¼Œä¸åŒ…å«launcheræœ¬èº«ã€‚
autovacuum_vacuum_threshold:é»˜è®¤50ã€‚ä¸autovacuum_vacuum_scale_factoré…åˆä½¿ç”¨ï¼Œ autovacuum_vacuum_scale_factoré»˜è®¤å€¼ä¸º20%ã€‚
                          å½“update,deleteçš„tuplesæ•°é‡è¶…è¿‡autovacuum_vacuum_scale_factor*table_size+autovacuum_vacuum_thresholdæ—¶ï¼Œè¿›è¡Œvacuumã€‚å¦‚æœè¦ä½¿vacuumå·¥ä½œå‹¤å¥‹ç‚¹ï¼Œåˆ™å°†æ­¤å€¼æ”¹å°ã€‚
autovacuum_analyze_threshold:é»˜è®¤50ã€‚ä¸autovacuum_analyze_scale_factoré…åˆä½¿ç”¨, autovacuum_analyze_scale_factoré»˜è®¤10%ã€‚
                          å½“update,insert,deleteçš„tuplesæ•°é‡è¶…è¿‡autovacuum_analyze_scale_factor*table_size+autovacuum_analyze_thresholdæ—¶ï¼Œè¿›è¡Œanalyzeã€‚
autovacuum_freeze_max_ageå’Œautovacuum_multixact_freeze_max_ageï¼šå‰é¢ä¸€ä¸ª200 million,åé¢ä¸€ä¸ª400 millionã€‚ç¦»ä¸‹ä¸€æ¬¡è¿›è¡Œxidå†»ç»“çš„æœ€å¤§äº‹åŠ¡æ•°ã€‚
autovacuum_vacuum_cost_delayï¼šå¦‚æœä¸º-1ï¼Œå–vacuum_cost_delayå€¼ã€‚
autovacuum_vacuum_cost_limitï¼šå¦‚æœä¸º-1ï¼Œåˆ°vacuum_cost_limitçš„å€¼ï¼Œè¿™ä¸ªå€¼æ˜¯æ‰€æœ‰workerçš„ç´¯åŠ å€¼ã€‚
</code></pre><h5 id="åŸºäºä»£ä»·çš„vacuumå‚æ•°">åŸºäºä»£ä»·çš„vacuumå‚æ•°:</h5>
<pre><code>vacuum_cost_delay ï¼šè®¡ç®—æ¯ä¸ªæ¯«ç§’çº§åˆ«æ‰€å…è®¸æ¶ˆè€—çš„æœ€å¤§IOï¼Œvacuum_cost_limit/vacuum_cost_delyã€‚ é»˜è®¤vacuum_cost_delayä¸º20æ¯«ç§’ã€‚
vacuum_cost_page_hit ï¼švacuumæ—¶ï¼Œpageåœ¨bufferä¸­å‘½ä¸­æ—¶ï¼Œæ‰€èŠ±çš„ä»£ä»·ã€‚é»˜è®¤å€¼ä¸º1ã€‚
vacuum_cost_page_missï¼švacuumæ—¶ï¼Œpageä¸åœ¨bufferä¸­ï¼Œéœ€è¦ä»ç£ç›˜ä¸­è¯»å…¥æ—¶çš„ä»£ä»·é»˜è®¤ä¸º10ã€‚ vacuum_cost_page_dirtyï¼šå½“vacuumæ—¶ï¼Œä¿®æ”¹äº†cleançš„pageã€‚è¿™è¯´æ˜éœ€è¦é¢å¤–çš„IOå»åˆ·è„å—åˆ°ç£ç›˜ã€‚é»˜è®¤å€¼ä¸º20ã€‚
vacuum_cost_limitï¼šå½“è¶…è¿‡æ­¤å€¼æ—¶ï¼Œvacuumä¼šsleepã€‚é»˜è®¤å€¼ä¸º200ã€‚
æŠŠä¸Šé¢æ¯ä¸ªcostå€¼è°ƒæ•´çš„å°ç‚¹ï¼Œç„¶åæŠŠlimitå€¼è°ƒçš„å¤§äº›ï¼Œå¯ä»¥å»¶é•¿æ¯æ¬¡vacuumçš„æ—¶é—´ã€‚è¿™æ ·åšï¼Œå¦‚æœåœ¨é«˜è´Ÿè½½çš„ç³»ç»Ÿå½“ä¸­ï¼Œå¯èƒ½IOä¼šæœ‰æ‰€å½±å“ï¼Œå› vacuumã€‚ä½†æ˜¯å¯¹äºè¡¨ç‰©ç†å­˜å‚¨ç©ºé—´çš„å¢é•¿ä¼šæœ‰æ‰€å‡ç¼“ã€‚
</code></pre><p><a href="http://blog.itpub.net/30088583/viewspace-1592066/">å‚è§</a></p>
<h4 id="æ‰©å±•é˜…è¯»-1">æ‰©å±•é˜…è¯»</h4>
<p>Autovacuum åŸºç¡€è°ƒä¼˜ <a href="https://mp.weixin.qq.com/s/ekKuDMEkQsZX5vx0VG0_1A">ä¸­æ–‡</a> <a href="https://blog.2ndquadrant.com/autovacuum-tuning-basics/#PostgreSQL%20Performance%20Tuning">è‹±æ–‡</a></p>
<h4 id="å®æˆ˜">å®æˆ˜</h4>
<p>autovacuum åœ¨è¾¾åˆ°è§¦å‘æ¡ä»¶æ—¶å°±ä¼šæ‰§è¡Œã€‚å¦‚æœè§¦å‘åœ¨ä¸šåŠ¡é«˜å³°æ—¶å‘ç”Ÿï¼Œå¯¹çº¿ä¸Šçš„ä¸šåŠ¡æ€§èƒ½ä¼šå¸¦æ¥å½±å“ã€‚åº”é¿å…ã€‚</p>
<p>æ•°æ®åº“çš„vacuum ä¸ºå¯æ§çš„ï¼Œé¿å…autovacuumå¯¹çº¿ä¸Šæ•°æ®åº“åœ¨è¿è¡Œé«˜å³°æ—¶çš„å½±å“ã€‚</p>
<p>åœ¨å¿…è¦æ—¶è¿›è¡Œæ‰‹åŠ¨æ‰§è¡Œvacuum ,åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œã€‚</p>
<p>ç›‘æ§æ•°æ®åº“çš„autovacuum ï¼Œä½¿å…¶åœ¨è¾¾åˆ°è§¦å‘æ¡ä»¶å‰è¢«åŠæ—¶å‘ç°ã€‚</p>
<h5 id="dba-ç»´æŠ¤">DBA ç»´æŠ¤</h5>
<ul>
<li>å‚è€ƒè¡¨ç©ºé—´è†¨èƒ€ç‡è®¡ç®—æ‰§è¡Œé¢„æœŸæ•ˆæœ</li>
<li>æ‰§è¡Œå‰è®¾ç½® maintenance_work_mem å¢åŠ ä¸´æ—¶ä½¿ç”¨å†…å­˜</li>
<li>æ‰§è¡Œå‰è®¾ç½® vacuum_cost_delay , vacuum_cost_limit è°ƒæ•´å¤„ç†é€Ÿåº¦</li>
<li>æ‰§è¡Œvacuum VERVOSE ANALYZE</li>
<li>æ‰§è¡Œanalyze æ›´æ–°ç»Ÿè®¡ä¿¡æ¯</li>
<li>è¿›åº¦æŸ¥çœ‹  select * from pg_stat_progress_vacuum ;</li>
<li>æ³¨æ„wal ç”Ÿæˆé€Ÿç‡ï¼Œå¯èƒ½ä¼šé€ æˆä»åº“è½åè¿‡å¤šã€‚walæ‰¾ä¸åˆ°é”™è¯¯ã€‚ä»åº“éœ€è¦é‡æ–°æ‹‰å–</li>
<li>æ³¨æ„ä¸šåŠ¡å³°å€¼æœŸå¯¹ä¸šåŠ¡çš„é€ æˆå½±å“</li>
<li>ç³»ç»ŸIOï¼Œä¸»ä»ä¸»æœºå¸¦å®½</li>
</ul>

        </div>

        


        

<div class="post-archive">
    <h2>å…¶ä»–æ–‡ç« </h2>
    <ul class="listing">
        
        <li><a href="/postgres/explain/">Explain æ‰§è¡Œè®¡åˆ’</a></li>
        
        <li><a href="/docker/nginx-log/">Nginx log åˆ‡å‰²</a></li>
        
        <li><a href="/middleware/vsftp/">Centos FTP æœåŠ¡</a></li>
        
    </ul>
</div>



        <div class="post-meta meta-tags">
            
            æ²¡æœ‰æ ‡ç­¾
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "your github repo"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2018 - 2021 <a href="https://zhangeamon.top"> By Eamon</a>
        
    </div>
    <br />
  
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>






    <script src='/js/douban.js'></script>


                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://zhangeamon.top/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://zhangeamon.top">
      <button type="submit" class="submit icon-search"></button>
</form>

    </section>
    
    <section class="widget">
        <h3 class="widget-title">æœ€è¿‘æ–‡ç« </h3>
<ul class="widget-list">
    
    <li>
        <a href="https://zhangeamon.top/linux/findhidpid/" title="Linux æ‰¾å‡ºéšè—è¿›ç¨‹">Linux æ‰¾å‡ºéšè—è¿›ç¨‹</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/network-security/wazuh/" title="Wazuh åŠŸèƒ½ç®€ä»‹">Wazuh åŠŸèƒ½ç®€ä»‹</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/linux/last/" title="Linux ç³»ç»Ÿç™»é™†è®°å½•">Linux ç³»ç»Ÿç™»é™†è®°å½•</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/linux/ubuntu2004-qa/" title="Ubuntu20.04 è£…æœºå">Ubuntu20.04 è£…æœºå</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/mysql/master-slave/" title="ä¸»ä»å¤åˆ¶">ä¸»ä»å¤åˆ¶</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/mysql/connections/" title="è¿æ¥æ•°ç®¡ç†">è¿æ¥æ•°ç®¡ç†</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/redis/pubsub/" title="å‘å¸ƒè®¢é˜…">å‘å¸ƒè®¢é˜…</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/redis/distributedlock/" title="åŸºäºRedis çš„åˆ†å¸ƒå¼é”å®ç°">åŸºäºRedis çš„åˆ†å¸ƒå¼é”å®ç°</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/postgres/libpg/" title="å®¢æˆ·ç«¯æ•…éšœè½¬ç§»">å®¢æˆ·ç«¯æ•…éšœè½¬ç§»</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/postgres/prepare/" title="ä½¿ç”¨prepareé¢„ç¼–è¯‘SQL">ä½¿ç”¨prepareé¢„ç¼–è¯‘SQL</a>
    </li>
    
</ul>

    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories'>åˆ†ç±»</a></h3>
<ul class="widget-list">
    
    <li><a href="https://zhangeamon.top/categories/ansible/">ansible (4)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/docker/">docker (1)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/etcd/">etcd (1)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/linux/">linux (15)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/mysql/">mysql (4)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/postgres/">postgres (19)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/python/">python (13)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/rabbitmq/">rabbitmq (2)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/redis/">redis (7)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">ä¸­é—´ä»¶ (10)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/%E5%AD%98%E5%82%A8/">å­˜å‚¨ (3)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/%E5%AE%89%E5%85%A8/">å®‰å…¨ (2)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/%E6%95%B0%E4%BB%93/">æ•°ä»“ (3)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/%E7%9B%91%E6%8E%A7/">ç›‘æ§ (2)</a></li>
    
</ul>

    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags.html'>æ ‡ç­¾</a></h3>
<div class="tagcloud">
    
    <a href="https://zhangeamon.top/tags/%E4%BC%98%E5%8C%96/">ä¼˜åŒ–</a>
    
    <a href="https://zhangeamon.top/tags/%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/">é…ç½®ç®¡ç†</a>
    
    <a href="https://zhangeamon.top/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/">é«˜å¯ç”¨</a>
    
</div>

    </section>

    
<section class="widget">
    <h3 class="widget-title">å‹æƒ…é“¾æ¥</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="http://www.cnblogs.com/zhangeamon" title="å†å²åšå®¢">å†å²åšå®¢</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">å…¶å®ƒ</h3>
        <ul class="widget-list">
            <li><a href="https://zhangeamon.top/index.xml">æ–‡ç«  RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
   
</body>

</html>
