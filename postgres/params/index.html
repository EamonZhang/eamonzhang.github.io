<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    

    <title>æ•°æ®åº“å‚æ•° | Let&#39;s go ğŸŒ ğŸŒ ğŸŒ</title>
    <meta property="og:title" content="æ•°æ®åº“å‚æ•° - Let&#39;s go ğŸŒ ğŸŒ ğŸŒ">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2018-11-27T09:57:27&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2018-11-27T09:57:27&#43;08:00'>
        
    <meta name="Keywords" content="postgres ã€pythonã€pg ã€linix ã€dockerã€ kubernetesã€ cloudã€hadoopã€promethues ">
    <meta name="description" content="æ•°æ®åº“å‚æ•°">
        
    <meta name="author" content="Eamon">
    <meta property="og:url" content="https://zhangeamon.top/postgres/params/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    
    
    <script type="text/javascript" src="/js/jquery.min.js"></script>
   
    
    
    
    
    
    
        <link rel="stylesheet" href='/css/douban.css'>
    
        <link rel="stylesheet" href='/css/other.css'>
    
   
        <a href=https://github.com/eamonzhang><img style="position: absolute; top: 0; left: 0; border: 0;" src="/images/forkme_left_red_aa0000.png" alt="Fork me on GitHub" data-canonical-src="/images/forkme_left_red_aa0000.png"></a>

   
        <script>
          var _hmt = _hmt || [];
            (function() {
            var hm = document.createElement("script");
            <!-- hm.src = "https://hm.baidu.com/hm.js?1f6605a363a50554aa03adcc685b7699"; -->
            hm.src = "https://hm.baidu.com/hm.js?0010600e9ae6ff8f5814bb7ec6b36072";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
          })();
       </script>
</head>

<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://zhangeamon.top">
                        Let&#39;s go ğŸŒ ğŸŒ ğŸŒ
                    </a>
                
                <p class="description">Let&#39;s build our own cloud native together  </p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://zhangeamon.top">é¦–é¡µ</a>
                    
                    <a  href="https://zhangeamon.top/archives" title="å½’æ¡£">å½’æ¡£</a>
                    
                    <a  href="https://zhangeamon.top/postgresql" title="Postgres">Postgres</a>
                    
                    <a  href="https://zhangeamon.top/linux" title="Linux">Linux</a>
                    
                    <a  href="https://zhangeamon.top/about/me" title="å…³äº">å…³äº</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: fixed;
        width: 200px;
        margin-left: -210px;
        padding: 5px 10px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 12px;
        border: 1px solid rgba(0, 0, 0, .07);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
        background-clip: padding-box;
        -webkit-box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        word-wrap: break-word;
        white-space: nowrap;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        z-index: 999;
        cursor: pointer;
        max-height: 70%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 20px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 15px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 10px 0;
    }

    .post-toc .post-toc-content ul {
        padding-left: 20px;
        list-style: square;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
        display: none;
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="position: absolute; top: 188px;">
    <h2 class="post-toc-title">ç›®å½•</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#æ€§èƒ½å‚æ•°">æ€§èƒ½å‚æ•°</a></li>
    <li><a href="#æ—¥å¿—å‚æ•°postgreslog"><a href="postgres/log/">æ—¥å¿—å‚æ•°</a></a></li>
    <li><a href="#æ›´å¤šå‚æ•°è¯¦è§£httpspostgresqlconfzhdocparam"><a href="https://postgresqlco.nf/zh/doc/param/">æ›´å¤šå‚æ•°è¯¦è§£</a></a></li>
    <li><a href="#ç®¡ç†">ç®¡ç†</a></li>
    <li><a href="#walæ—¥å¿—">walæ—¥å¿—</a></li>
    <li><a href="#æˆæœ¬å› å­">æˆæœ¬å› å­</a></li>
    <li><a href="#tcp-è¿æ¥">TCP è¿æ¥</a></li>
    <li><a href="#æ£€æŸ¥ç‚¹checkpoint">æ£€æŸ¥ç‚¹checkpoint</a></li>
    <li><a href="#åƒåœ¾å›æ”¶autovacuum">åƒåœ¾å›æ”¶autovacuum</a></li>
    <li><a href="#å¹¶è¡Œè®¡ç®—">å¹¶è¡Œè®¡ç®—</a></li>
    <li><a href="#åŒæ­¥æäº¤synchronous_commit">åŒæ­¥æäº¤synchronous_commit</a></li>
    <li><a href="#ä¿®æ”¹">ä¿®æ”¹</a></li>
    <li><a href="#ç­–ç•¥">ç­–ç•¥ã€€</a></li>
    <li><a href="#æŸ¥çœ‹">æŸ¥çœ‹</a></li>
    <li><a href="#work_mem">work_mem</a></li>
    <li><a href="#å®éªŒ">å®éªŒ</a></li>
    <li><a href="#maintainance_work_mem">maintainance_work_mem</a></li>
    <li><a href="#å®éªŒ-1">å®éªŒ</a></li>
  </ul>
</nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var leftPos = $("#main").offset().left;
            if(leftPos<220){
                postToc.css({"width":leftPos-10,"margin-left":(0-leftPos)})
            }

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }
    })
</script>

    <article class="post">
        <header>
            <h1 class="post-title">æ•°æ®åº“å‚æ•°</h1>
        </header>
        <date class="post-meta meta-date">
            2018å¹´11æœˆ27æ—¥
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='/categories/postgres'>postgres</a></span>
            
        </div>
        
        
        
        <div class="clear" style="display: none">
            <div class="toc-article">
                <div class="toc-title">æ–‡ç« ç›®å½•</div>
            </div>
        </div>
        
        <div class="post-content">
            <h2 id="æ€§èƒ½å‚æ•°">æ€§èƒ½å‚æ•°</h2>
<p><a href="https://github.com/le0pard/pgtune">pgtune</a> <a href="https://www.pgconfig.org/">pgconfig</a></p>
<h2 id="æ—¥å¿—å‚æ•°postgreslog"><a href="postgres/log/">æ—¥å¿—å‚æ•°</a></h2>
<h2 id="æ›´å¤šå‚æ•°è¯¦è§£httpspostgresqlconfzhdocparam"><a href="https://postgresqlco.nf/zh/doc/param/">æ›´å¤šå‚æ•°è¯¦è§£</a></h2>
<h2 id="ç®¡ç†">ç®¡ç†</h2>
<pre><code>listen_addresses = &quot;*&quot;             # è¿æ¥è®¿é—®æ§åˆ¶ï¼Œå“ªäº›ipå¯ä»¥è®¿é—®ï¼Œ * å…¨éƒ¨ã€‚ ç»“åˆpg_hba.conf , iptablesè®¾ç½®ã€‚
superuser_reserved_connections = 3 # é¢„ç•™ç»™è¶…çº§ç®¡ç†å‘˜çš„è¿æ¥æ•°ã€‚
port = 5432                        # é»˜è®¤è®¿é—®ç«¯å£
wal_keep_segments = 1024           # wal æ—¥å¿—ä¿å­˜æ•°é‡
</code></pre><h2 id="walæ—¥å¿—">walæ—¥å¿—</h2>
<pre><code>wal_log_hints = on 
full_page_writes = on
</code></pre><h2 id="æˆæœ¬å› å­">æˆæœ¬å› å­</h2>
<pre><code># - Planner Cost Constants -
#seq_page_cost = 1.0                    # measured on an arbitrary scale é¡ºåºæ‰«æ
random_page_cost = 1.1                  # same scale as above            éšæœºæ‰«æã€‚HDD 4 ;SSD 1.1; ç”±äºSSDæ²¡æœ‰ç£ç›˜å¯»é“æ—¶é—´ï¼Œé¡ºåºæ‰«æå’Œéšæœºæ‰«æçš„å·®è·ä¸æ˜¯é‚£ä¹ˆå¤§ã€‚æ¯”ä¾‹è®¾ç½®çš„ç›¸è¿‘å³å¯ã€‚ 
#cpu_tuple_cost = 0.01                  # same scale as above
#cpu_index_tuple_cost = 0.005           # same scale as above
#cpu_operator_cost = 0.0025             # same scale as above
#parallel_tuple_cost = 0.1              # same scale as above
#parallel_setup_cost = 1000.0   # same scale as above
#min_parallel_table_scan_size = 8MB
#min_parallel_index_scan_size = 512kB
effective_cache_size = 666666          # ç³»ç»Ÿæ€»å†…å­˜å‡å»æ•°æ®åº“shared_bufferå‡å»å…¶ä»–åº”ç”¨å æœ‰çš„å†…å­˜ã€‚ ç†è§£ä¸ºæ•°æ®å¯åŠ è½½åˆ°å†…å­˜çš„å¤§å°ã€‚
</code></pre><h2 id="tcp-è¿æ¥">TCP è¿æ¥</h2>
<p>Linux ä¸­tcpé»˜è®¤è¿æ¥è¶…æ—¶æ—¶é—´2å°æ—¶,å¦‚æœ2ä¸ªå°æ—¶æ²¡æœ‰æ•°æ®åŒ…åˆ™è®¤ä¸ºè¯¥è¿æ¥ä¸ºç©ºé—²çŠ¶æ€ï¼Œç³»ç»Ÿè‡ªåŠ¨å…³é—­ã€‚</p>
<pre><code># - TCP Keepalives -
# see &quot;man 7 tcp&quot; for details

#tcp_keepalives_idle = 60                # TCP_KEEPIDLE, in seconds;
                                        # 0 selects the system default
#tcp_keepalives_interval = 10            # TCP_KEEPINTVL, in seconds;  å‘ä¸ªå¿ƒè·³æ•°æ®åŒ…ï¼Œå‘Šè¯‰ç³»ç»Ÿæˆ‘æ²¡æœ‰ç©ºé—²
                                        # 0 selects the system default
#tcp_keepalives_count = 6               # TCP_KEEPCNT;
                                        # 0 selects the system default
</code></pre><h2 id="æ£€æŸ¥ç‚¹checkpoint">æ£€æŸ¥ç‚¹checkpoint</h2>
<p>å…·ä½“æ ¹æ®ç£ç›˜çš„ååé‡è¿›è¡Œè®¾ç½® <a href="https://yq.aliyun.com/articles/582847">https://yq.aliyun.com/articles/582847</a></p>
<pre><code>shared_buffers = 64GB                  # 1/4 å†…å­˜ å¦‚æœä¸ä½¿ç”¨huge pageå»ºè®®ä¸è¦è¶…è¿‡32GB   
checkpoint_timeout = 30min              # range 30s-1d  
max_wal_size = 124GB          # 2*shared_buffers  
min_wal_size = 32GB           # shared_buffers * 1/2  
checkpoint_completion_target = 0.9 
</code></pre><h2 id="åƒåœ¾å›æ”¶autovacuum">åƒåœ¾å›æ”¶autovacuum</h2>
<pre><code>autovacuum_work_mem = -1 # autovacuumæ‰€èƒ½ä½¿ç”¨çš„å†…å­˜å¤§å°ï¼Œå½“å…¶ä¸º-1æ—¶ï¼Œä½¿ç”¨maintenance_work_memå‚æ•°çš„å€¼ï¼Œå€¼è¶Šå¤§ï¼Œä½¿ç”¨çš„å†…å­˜è¶Šå¤š
autovacuum = on # æ˜¯å¦æ‰“å¼€autovacuum
autovacuum_max_workers =3 # æœ€å¤šèƒ½å¤Ÿæœ‰å¤šå°‘ä¸ªautovaccumè¿›ç¨‹è¿è¡Œï¼Œå€¼è¶Šå¤§ï¼Œä½¿ç”¨çš„å†…å­˜è¶Šå¤š
autovacuum_naptime = 1min  # autovacuumè¿›ç¨‹é—´éš”å¤šé•¿æ—¶é—´å¯¹è¡¨è¿›è¡Œæ˜¯å¦éœ€è¦autovacuumæ“ä½œ
autovacuum_vacuum_threshold = 50 # å½“è¡¨ä¸Šdmlæ“ä½œè¾¾åˆ°å¤šå°‘è¡Œæ—¶æ‰§è¡Œautovacuumæ“ä½œ
autovacuum_analyze_threshold = 50  # å½“è¡¨ä¸Šdmlæ“ä½œè¾¾åˆ°å¤šå°‘è¡Œæ—¶æ‰§è¡Œautovacuum analyzeæ“ä½œ
autovacuum_vacuum_scale_factor = 0.2 # å½“è¡¨ä¸Šdmlæ“ä½œè¾¾åˆ°å¤šå°‘æ¯”ä¾‹æ—¶æ‰§è¡Œautovacuumæ“ä½œ
autovacuum_analyze_scale_factor = 0.1  # å½“è¡¨ä¸Šdmlæ“ä½œè¾¾åˆ°å¤šå°‘æ¯”ä¾‹æ—¶æ‰§è¡Œautovacuum analyzeæ“ä½œ
autovacuum_vacuum_cost_limit = -1  # autovacuum çš„costè¶…è¿‡æ­¤å€¼æ—¶ï¼Œvacuumä¼šsleepä¸€æ®µæ—¶é—´ï¼Œä½¿ç”¨vacuum_cost_limitå‚æ•°çš„å€¼ï¼Œå€¼è¶Šå¤§å¯¹ç³»ç»ŸIOå‹åŠ›è¶Šå¤§
</code></pre><h2 id="å¹¶è¡Œè®¡ç®—">å¹¶è¡Œè®¡ç®—</h2>
<pre><code>1. æ§åˆ¶æ•´ä¸ªæ•°æ®åº“é›†ç¾¤åŒæ—¶èƒ½å¼€å¯å¤šå°‘ä¸ªwork processï¼Œå¿…é¡»è®¾ç½®ã€‚
max_worker_processes = 128              # (change requires restart)  

2. æ§åˆ¶ä¸€ä¸ªå¹¶è¡Œçš„EXEC NODEæœ€å¤šèƒ½å¼€å¯å¤šå°‘ä¸ªå¹¶è¡Œå¤„ç†å•å…ƒï¼ŒåŒæ—¶è¿˜éœ€è¦å‚è€ƒè¡¨çº§å‚æ•°parallel_workersï¼Œæˆ–è€…PGå†…æ ¸å†…ç½®çš„ç®—æ³•ï¼Œæ ¹æ®è¡¨çš„å¤§å°è®¡ç®—éœ€è¦å¼€å¯å¤šå°‘å’Œå¹¶è¡Œå¤„ç†å•å…ƒã€‚  
å®é™…å–å°çš„ã€‚
max_parallel_workers_per_gather = 16    # taken from max_worker_processes

3. è®¡ç®—å¹¶è¡Œå¤„ç†çš„æˆæœ¬ï¼Œå¦‚æœæˆæœ¬é«˜äºéå¹¶è¡Œï¼Œåˆ™ä¸ä¼šå¼€å¯å¹¶è¡Œå¤„ç†ã€‚
#parallel_tuple_cost = 0.1              # same scale as above
#parallel_setup_cost = 1000.0   # same scale as above

4. å°äºè¿™ä¸ªå€¼çš„è¡¨ï¼Œä¸ä¼šå¼€å¯å¹¶è¡Œã€‚
#min_parallel_relation_size = 8MB

5. å‘Šè¯‰ä¼˜åŒ–å™¨ï¼Œå¼ºåˆ¶å¼€å¯å¹¶è¡Œã€‚
#force_parallel_mode = off

6. è¡¨çº§å‚æ•°ï¼Œä¸é€šè¿‡è¡¨çš„å¤§å°è®¡ç®—å¹¶è¡Œåº¦ï¼Œè€Œæ˜¯ç›´æ¥å‘Šè¯‰ä¼˜åŒ–å™¨è¿™ä¸ªè¡¨éœ€è¦å¼€å¯å¤šå°‘ä¸ªå¹¶è¡Œè®¡ç®—å•å…ƒã€‚
parallel_workers (integer)

alter table t_table set(parallel_workers = 4)
</code></pre><h2 id="åŒæ­¥æäº¤synchronous_commit">åŒæ­¥æäº¤synchronous_commit</h2>
<p>åŒæ­¥æäº¤å‚æ•°, æ§åˆ¶äº‹åŠ¡æäº¤åè¿”å›å®¢æˆ·ç«¯æ˜¯å¦æˆåŠŸçš„ç­–ç•¥
å¯é€‰å€¼ä¸º:on, remote_write, local, off</p>
<p>on</p>
<pre><code>1 ä¸ºonä¸”æ²¡æœ‰å¼€å¯åŒæ­¥å¤‡åº“çš„æ—¶å€™,ä¼šå½“walæ—¥å¿—çœŸæ­£åˆ·æ–°åˆ°ç£ç›˜æ°¸ä¹…å­˜å‚¨åæ‰ä¼šè¿”å›å®¢æˆ·ç«¯äº‹åŠ¡å·²æäº¤æˆåŠŸ, 
2 å½“ä¸ºonä¸”å¼€å¯äº†åŒæ­¥å¤‡åº“çš„æ—¶å€™(è®¾ç½®äº†synchronous_standby_names),å¿…é¡»è¦ç­‰äº‹åŠ¡æ—¥å¿—åˆ·æ–°åˆ°æœ¬åœ°ç£ç›˜,å¹¶ä¸”è¿˜è¦ç­‰è¿œç¨‹å¤‡åº“ä¹Ÿæäº¤åˆ°ç£ç›˜æ‰èƒ½è¿”å›å®¢æˆ·ç«¯å·²ç»æäº¤.
</code></pre><p>off</p>
<pre><code>å†™åˆ°ç¼“å­˜ä¸­å°±ä¼šå‘å®¢æˆ·ç«¯è¿”å›æäº¤æˆåŠŸï¼Œä½†ä¹Ÿä¸æ˜¯ä¸€ç›´ä¸åˆ·åˆ°ç£ç›˜ï¼Œå»¶è¿Ÿå†™å…¥ç£ç›˜,å»¶è¿Ÿçš„æ—¶é—´ä¸ºæœ€å¤§3å€çš„wal_writer_delayå‚æ•°çš„(é»˜è®¤200ms)çš„æ—¶é—´,æ‰€æœ‰å¦‚æœå³ä½¿å…³é—­synchronous_commit,
ä¹Ÿåªä¼šé€ æˆæœ€å¤š600msçš„äº‹åŠ¡ä¸¢å¤±,æ­¤äº‹åŠ¡ç”šè‡³åŒ…æ‹¬å·²ç»æäº¤çš„äº‹åŠ¡ï¼ˆä¼šä¸¢æ•°æ®ï¼‰,ä½†æ•°æ®åº“ç¡®å¯ä»¥å®‰å…¨å¯åŠ¨,ä¸ä¼šå‘ç”Ÿå—æŠ˜æ–­,åªæ˜¯ä¸¢å¤±äº†éƒ¨åˆ†æ•°æ®,ä½†å¯¹é«˜å¹¶å‘çš„å°äº‹åŠ¡ç³»ç»Ÿæ¥è¯´,æ€§èƒ½æ¥è¯´æå‡è¾ƒå¤§ã€‚
</code></pre><p>remote_write</p>
<pre><code>å½“äº‹åŠ¡æäº¤æ—¶,ä¸ä»…è¦æŠŠwalåˆ·æ–°åˆ°ç£ç›˜,è¿˜éœ€è¦ç­‰walæ—¥å¿—å‘é€åˆ°å¤‡åº“æ“ä½œç³»ç»Ÿ(ä½†ä¸ç”¨ç­‰å¤‡åº“åˆ·æ–°åˆ°ç£ç›˜),å› æ­¤å¦‚æœå¤‡åº“æ­¤æ—¶å‘ç”Ÿå®ä¾‹ä¸­æ–­ä¸ä¼šæœ‰æ•°æ®ä¸¢å¤±,å› ä¸ºæ•°æ®è¿˜åœ¨æ“ä½œç³»ç»Ÿä¸Š,
è€Œå¦‚æœæ“ä½œç³»ç»Ÿæ•…éšœ,åˆ™æ­¤éƒ¨åˆ†walæ—¥å¿—è¿˜æ²¡æœ‰æ¥å¾—åŠå†™å…¥ç£ç›˜å°±ä¼šä¸¢å¤±,å¤‡åº“å¯åŠ¨åè¿˜éœ€è¦æƒ³ä¸»åº“ç´¢å–walæ—¥å¿—ã€‚
</code></pre><p>local</p>
<pre><code>å½“äº‹åŠ¡æäº¤æ—¶,ä»…å†™å…¥æœ¬åœ°ç£ç›˜å³å¯è¿”å›å®¢æˆ·ç«¯äº‹åŠ¡æäº¤æˆåŠŸ,è€Œä¸ç®¡æ˜¯å¦æœ‰åŒæ­¥å¤‡åº“
å¦‚æœæ²¡æœ‰è®¾ç½®åŒæ­¥å¤‡åº“,åˆ™ on/remote_write/localéƒ½æ˜¯ä¸€æ ·çš„,ä»…ç­‰å¾…äº‹åŠ¡åˆ·æ–°åˆ°æœ¬åœ°ç£ç›˜.
</code></pre><p>æ­¤å‚æ•°è¿˜å¯ä»¥å±€éƒ¨è®¾ç½®,å½“æœ‰ä¸´æ—¶æ‰¹é‡ä»»åŠ¡æ—¶å¯ä»¥è¿™æ ·è®¾ç½®:</p>
<pre><code>SET LOCAL synchronous_commit TO OFF; 
</code></pre><p>è¿™æ ·å±€éƒ¨äº‹åŠ¡å¯å‘å¤‡åº“å¼‚æ­¥çš„æ–¹å¼åŒæ­¥ï¼Œè€Œå…¶ä»–é‡è¦çš„äº‹åŠ¡ä»¥åŒæ­¥çš„æ–¹å¼å‘å¤‡åº“åŒæ­¥ã€‚</p>
<h2 id="ä¿®æ”¹">ä¿®æ”¹</h2>
<pre><code>postgresql.conf æœåŠ¡å™¨å¯åŠ¨æ—¶é»˜è®¤è¯»å–çš„é…ç½®

postgresql.auto.conf ä¼˜å…ˆçº§é«˜äºpostgresql.conf 9.4åå¼•å…¥,å¯¹æ ‡oracle sfile pfile ã€‚ã€€æ–‡ä»¶ä¸èƒ½ä¿®æ”¹,éœ€è¦é€šè¿‡ALTER SYSTEã€€ä¿®æ”¹ï¼ŒALTER SYSTEã€€RESET | DEFAULT åˆ é™¤
</code></pre><h2 id="ç­–ç•¥">ç­–ç•¥ã€€</h2>
<pre><code>postgresql.conf å‚æ•°ä¸ºé»˜è®¤å€¼,ä¸åšä¿®æ”¹ï¼Œä¼˜åŒ–å‚æ•°é€šè¿‡ã€€postgresql.auto.conf ä¿®æ”¹ï¼Œä¸€ç›®äº†ç„¶ã€‚(ä¸ªäººä¹ æƒ¯)
</code></pre><h2 id="æŸ¥çœ‹">æŸ¥çœ‹</h2>
<pre><code>SELECT name,setting,vartype,boot_val,min_val,max_val,reset_val FROM pg_settings;

show all;
</code></pre><h2 id="work_mem">work_mem</h2>
<p>è¿™äº›å†…å­˜å¤§å°è¢«ç”¨æ¥å®Œæˆå†…éƒ¨æ’åºä¸å“ˆå¸Œè¡¨æ“ä½œã€‚
å¦‚æœæœªåˆ†é…è¶³å¤Ÿå†…å­˜ï¼Œä¼šå¯¼è‡´ç‰©ç†I/Oã€‚
work_memè¿™ä¸ªå€¼æ˜¯é’ˆå¯¹æ¯ä¸ªsessionçš„ï¼Œæ‰€ä»¥ä¸èƒ½è®¾ç½®çš„è¿‡å¤§ã€‚</p>
<h2 id="å®éªŒ">å®éªŒ</h2>
<pre><code>åˆ›å»ºæµ‹è¯•è¡¨
postgres=# create table myt (id serial);  
CREATE TABLE

æ’å…¥æµ‹è¯•æ•°æ®  
postgres=# insert into myt select generate_series(1,1000000);  
INSERT 0 1000000  

è®¾ç½®å½“å‰session work_mem

postgres=#set work_me '64kb';
SET  
postgres=# show work_mem;  
 work_mem  
----------  
 64kB  
(1 row)

æŸ¥çœ‹ä¸´æ—¶æ–‡ä»¶å ç”¨æƒ…å†µ
select temp_files, temp_bytes from pg_stat_database
 temp_files | temp_bytes  
------------+------------  
          0 |          0  
(1 row)  

æ‰§è¡Œæµ‹è¯•
select * from (select * from myt order by id) t limit 1000; 

å†æ¬¡æŸ¥çœ‹ä¸´æ—¶æ–‡ä»¶å ç”¨æƒ…å†µ
select temp_files, temp_bytes from pg_stat_database
 temp_files | temp_bytes
------------+------------
          1 |   14016512 
(1 row)

è®¾ç½®å½“å‰session work_mem

postgres=#set work_mem = '16MB';  
SET

æ‰§è¡Œæµ‹è¯•
select * from (select * from myt order by id) t limit 1000;

å†æ¬¡æŸ¥çœ‹ä¸´æ—¶æ–‡ä»¶å ç”¨æƒ…å†µ
select temp_files, temp_bytes from pg_stat_database
 temp_files | temp_bytes
------------+------------
          1 |   14016512
</code></pre><p>æ²¡æœ‰æ–°å¢ä¸´æ—¶æ–‡ä»¶ , è¯´æ˜work_memå……è¶³</p>
<h2 id="maintainance_work_mem">maintainance_work_mem</h2>
<p>ä¸»è¦ç”¨äºanalyzingï¼Œvacuumï¼Œcreate index, reindexç­‰ã€‚</p>
<p>å¦‚éœ€è¿›è¡Œå¦‚ä¸Šæ“ä½œæ—¶è¯·é€‚å½“è°ƒæ•´maintainance_work_mem å€¼ï¼Œæé«˜æ•ˆç‡</p>
<h2 id="å®éªŒ-1">å®éªŒ</h2>
<p>æ–¹æ³•ä¸ä¸Šé¢ç±»ä¼¼ï¼Œåœ¨ç»Ÿè®¡è¡¨ä¸­è§‚å¯Ÿä¸´æ—¶æ–‡ä»¶ä½¿ç”¨æƒ…å†µã€‚</p>

        </div>

        


        

<div class="post-archive">
    <h2>å…¶ä»–æ–‡ç« </h2>
    <ul class="listing">
        
        <li><a href="/tidb/lsm/">LSM Overview</a></li>
        
        <li><a href="/middleware/haproxy/">Haproxy ç®—æ³•</a></li>
        
        <li><a href="/monitor/prometheus-altermanager/">Promethues Altermanager æŠ¥è­¦</a></li>
        
    </ul>
</div>



        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/'></a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "your github repo"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2018 - 2021 <a href="https://zhangeamon.top"> By Eamon</a>
        
    </div>
    <br />
  
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>






    <script src='/js/douban.js'></script>


                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://zhangeamon.top/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://zhangeamon.top">
      <button type="submit" class="submit icon-search"></button>
</form>

    </section>
    
    <section class="widget">
        <h3 class="widget-title">æœ€è¿‘æ–‡ç« </h3>
<ul class="widget-list">
    
    <li>
        <a href="https://zhangeamon.top/python/simple-demo/" title="python ç®€å•ç¤ºä¾‹">python ç®€å•ç¤ºä¾‹</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/redis/long-polling/" title="é•¿è½®è¯¢">é•¿è½®è¯¢</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/redis/automated-keyword/" title="è”æƒ³æœç´¢">è”æƒ³æœç´¢</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/python/push_messages/" title="æ¶ˆæ¯æ¨é€">æ¶ˆæ¯æ¨é€</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/postgres/pg_elk/" title="æ•°æ®åº“æ—¥å¿—åˆ†æ">æ•°æ®åº“æ—¥å¿—åˆ†æ</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/linux/findhidpid/" title="Linux æ‰¾å‡ºéšè—è¿›ç¨‹">Linux æ‰¾å‡ºéšè—è¿›ç¨‹</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/network-security/wazuh/" title="Wazuh åŠŸèƒ½ç®€ä»‹">Wazuh åŠŸèƒ½ç®€ä»‹</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/linux/last/" title="Linux ç³»ç»Ÿç™»é™†è®°å½•">Linux ç³»ç»Ÿç™»é™†è®°å½•</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/linux/ubuntu2004-qa/" title="Ubuntu20.04 è£…æœºå">Ubuntu20.04 è£…æœºå</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/mysql/master-slave/" title="ä¸»ä»å¤åˆ¶">ä¸»ä»å¤åˆ¶</a>
    </li>
    
</ul>

    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories'>åˆ†ç±»</a></h3>
<ul class="widget-list">
    
    <li><a href="https://zhangeamon.top/categories/ansible/">ansible (4)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/docker/">docker (1)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/etcd/">etcd (1)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/linux/">linux (16)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/mysql/">mysql (4)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/nginx/">nginx (2)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/postgres/">postgres (22)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/python/">python (17)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/rabbitmq/">rabbitmq (2)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/redis/">redis (9)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">ä¸­é—´ä»¶ (9)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/%E5%AD%98%E5%82%A8/">å­˜å‚¨ (3)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/%E5%AE%89%E5%85%A8/">å®‰å…¨ (2)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/%E6%95%B0%E4%BB%93/">æ•°ä»“ (3)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/%E7%9B%91%E6%8E%A7/">ç›‘æ§ (2)</a></li>
    
</ul>

    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags.html'>æ ‡ç­¾</a></h3>
<div class="tagcloud">
    
    <a href="https://zhangeamon.top/tags/%E4%BC%98%E5%8C%96/">ä¼˜åŒ–</a>
    
    <a href="https://zhangeamon.top/tags/%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/">é…ç½®ç®¡ç†</a>
    
    <a href="https://zhangeamon.top/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/">é«˜å¯ç”¨</a>
    
</div>

    </section>

    
<section class="widget">
    <h3 class="widget-title">å‹æƒ…é“¾æ¥</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="http://www.cnblogs.com/zhangeamon" title="å†å²åšå®¢">å†å²åšå®¢</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">å…¶å®ƒ</h3>
        <ul class="widget-list">
            <li><a href="https://zhangeamon.top/index.xml">æ–‡ç«  RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
   
</body>

</html>
