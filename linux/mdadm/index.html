<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    

    <title>mdadm è½¯Raid ç®¡ç† | Let&#39;s go ğŸŒ ğŸŒ ğŸŒ</title>
    <meta property="og:title" content="mdadm è½¯Raid ç®¡ç† - Let&#39;s go ğŸŒ ğŸŒ ğŸŒ">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2018-12-03T13:39:39&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2018-12-03T13:39:39&#43;08:00'>
        
    <meta name="Keywords" content="postgres ã€pythonã€pg ã€linix ã€dockerã€ kubernetesã€ cloudã€hadoopã€promethues ">
    <meta name="description" content="mdadm è½¯Raid ç®¡ç†">
        
    <meta name="author" content="Eamon">
    <meta property="og:url" content="https://zhangeamon.top/linux/mdadm/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    
    
    <script type="text/javascript" src="/js/jquery.min.js"></script>
   
    
    
    
    
    
    
        <link rel="stylesheet" href='/css/douban.css'>
    
        <link rel="stylesheet" href='/css/other.css'>
    
   
        <a href=https://github.com/eamonzhang><img style="position: absolute; top: 0; left: 0; border: 0;" src="/images/forkme_left_red_aa0000.png" alt="Fork me on GitHub" data-canonical-src="/images/forkme_left_red_aa0000.png"></a>

   
        <script>
          var _hmt = _hmt || [];
            (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?1f6605a363a50554aa03adcc685b7699";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
          })();
       </script>
</head>

<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://zhangeamon.top">
                        Let&#39;s go ğŸŒ ğŸŒ ğŸŒ
                    </a>
                
                <p class="description">Let&#39;s build our own cloud native together  </p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://zhangeamon.top">é¦–é¡µ</a>
                    
                    <a  href="https://zhangeamon.top/archives" title="å½’æ¡£">å½’æ¡£</a>
                    
                    <a  href="https://zhangeamon.top/postgresql" title="Postgres">Postgres</a>
                    
                    <a  href="https://zhangeamon.top/linux" title="Linux">Linux</a>
                    
                    <a  href="https://zhangeamon.top/about/me" title="å…³äº">å…³äº</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    

    <article class="post">
        <header>
            <h1 class="post-title">mdadm è½¯Raid ç®¡ç†</h1>
        </header>
        <date class="post-meta meta-date">
            2018å¹´12æœˆ3æ—¥
        </date>
        
        
        
        <div class="post-content">
            <h4 id="èƒŒæ™¯">èƒŒæ™¯</h4>
<p>mdadmæ˜¯linuxä¸‹ç”¨äºåˆ›å»ºå’Œç®¡ç†è½¯ä»¶RAIDçš„å‘½ä»¤ï¼Œæ˜¯ä¸€ä¸ªæ¨¡å¼åŒ–å‘½ä»¤ã€‚ä½†ç”±äºç°åœ¨æœåŠ¡å™¨ä¸€èˆ¬éƒ½å¸¦æœ‰RAIDé˜µåˆ—å¡ï¼Œå¹¶ä¸”RAIDé˜µåˆ—å¡ä¹Ÿå¾ˆå»‰ä»·ï¼Œä¸”ç”±äºè½¯ä»¶RAIDçš„è‡ªèº«ç¼ºé™·ï¼ˆä¸èƒ½ç”¨ä½œå¯åŠ¨åˆ†åŒºã€ä½¿ç”¨CPUå®ç°ï¼Œé™ä½CPUåˆ©ç”¨ç‡ï¼‰ï¼Œå› æ­¤åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹å¹¶ä¸é€‚ç”¨ã€‚ä½†ä¸ºäº†å­¦ä¹ å’Œäº†è§£RAIDåŸç†å’Œç®¡ç†ï¼Œå› æ­¤ä»ç„¶è¿›è¡Œä¸€ä¸ªè¯¦ç»†çš„è®²è§£ï¼š</p>
<h4 id="å®‰è£…">å®‰è£…</h4>
<pre><code>yum install mdadm -y
</code></pre><h4 id="ç»„å»ºraid">ç»„å»ºraid</h4>
<pre><code>ç»„è£…raid 
mdadm -C /dev/md0 -a yes -n 4 -l 10 /dev/sdb /dev/sdc /dev/sdd /dev/sde

è¯´æ˜ : 
ä¸“ç”¨é€‰é¡¹ï¼š
-l çº§åˆ«
-n è®¾å¤‡ä¸ªæ•°
-a {yes|no} è‡ªåŠ¨ä¸ºå…¶åˆ›å»ºè®¾å¤‡æ–‡ä»¶
-c æŒ‡å®šæ•°æ®å—å¤§å°ï¼ˆchunkï¼‰
-x æŒ‡å®šç©ºé—²ç›˜ï¼ˆçƒ­å¤‡ç£ç›˜ï¼‰ä¸ªæ•°ï¼Œç©ºé—²ç›˜ï¼ˆçƒ­å¤‡ç£ç›˜ï¼‰èƒ½åœ¨å·¥ä½œç›˜æŸååè‡ªåŠ¨é¡¶æ›¿
æ³¨æ„ï¼šåˆ›å»ºé˜µåˆ—æ—¶ï¼Œé˜µåˆ—æ‰€éœ€ç£ç›˜æ•°ä¸º-nå‚æ•°å’Œ-xå‚æ•°çš„ä¸ªæ•°å’Œ
</code></pre><pre><code>æŸ¥çœ‹çŠ¶æ€, ç»„è£…è¿›åº¦ç­‰
mdadm -D /dev/md0

ä¹Ÿå¯ä»¥é€šè¿‡mdstatæŸ¥çœ‹çŠ¶æ€
cat /proc/mdstat

Personalities : [raid10] 
md127 : active raid10 sdd[2] sda[3] sdb[0] sdc[1]
      999950336 blocks super 1.2 512K chunks 2 near-copies [4/4] [UUUU]
      bitmap: 1/8 pages [4KB], 65536KB chunk

unused devices: &lt;none&gt;
</code></pre><pre><code>å¦‚ä¸‹ä¿¡æ¯è¯´æ˜ï¼š æç¤ºè½¯raid ä¸èƒ½ä½œä¸ºå¯åŠ¨åˆ†åŒº
mdadm: Note: this array has metadata at the start and
    may not be suitable as a boot device.  If you plan to
    store '/boot' on this device please ensure that
    your boot-loader understands md/v1.x metadata, or use
    --metadata=0.90
Continue creating array? y
</code></pre><h4 id="ç®¡ç†">ç®¡ç†</h4>
<p>é€‰é¡¹ï¼š-a(&ndash;add)ï¼Œ-d(&ndash;del),-r(&ndash;remove),-f(&ndash;fail)</p>
<h5 id="æ¨¡æ‹ŸæŸå">æ¨¡æ‹ŸæŸå</h5>
<pre><code>mdadm /dev/md1 -f /dev/sdb5
</code></pre><h5 id="ç§»é™¤æŸåçš„ç£ç›˜">ç§»é™¤æŸåçš„ç£ç›˜</h5>
<pre><code>mdadm /dev/md1 -r /dev/sdb5
</code></pre><h5 id="æ·»åŠ æ–°çš„ç¡¬ç›˜åˆ°å·²æœ‰é˜µåˆ—">æ·»åŠ æ–°çš„ç¡¬ç›˜åˆ°å·²æœ‰é˜µåˆ—</h5>
<pre><code>mdadm /dev/md1 -a /dev/sdb7     
æ³¨æ„:   
1 æ–°å¢åŠ çš„ç¡¬ç›˜éœ€è¦ä¸åŸç¡¬ç›˜å¤§å°ä¸€è‡´    
2 å¦‚æœåŸæœ‰é˜µåˆ—ç¼ºå°‘å·¥ä½œç£ç›˜ï¼ˆå¦‚raid1åªæœ‰ä¸€å—åœ¨å·¥ä½œï¼Œraid5åªæœ‰2å—åœ¨å·¥ä½œï¼‰ï¼Œè¿™æ—¶æ–°å¢åŠ çš„ç£ç›˜ç›´æ¥å˜ä¸ºå·¥ä½œç£ç›˜ï¼Œå¦‚æœåŸæœ‰é˜µåˆ—å·¥ä½œæ­£å¸¸ï¼Œåˆ™æ–°å¢åŠ çš„ç£ç›˜ä¸ºçƒ­å¤‡ç£ç›˜ã€‚ 
</code></pre><h5 id="é‡æ–°æ·»åŠ ">é‡æ–°æ·»åŠ </h5>
<pre><code>mdadm /dev/md1 --re-add /dev/sdb7
</code></pre><h5 id="åœæ­¢é˜µåˆ—">åœæ­¢é˜µåˆ—</h5>
<pre><code>é€‰é¡¹ï¼š-S = --stop
mdadm -S /dev/md1
</code></pre><h5 id="å¯åŠ¨é˜µåˆ—">å¯åŠ¨é˜µåˆ—</h5>
<pre><code>é€‰é¡¹ï¼š-R= --run
mdadm -R  /dev/md1
</code></pre><p><a href="https://www.cnblogs.com/zhangeamon/p/6866429.html">è¯¦æƒ…</a></p>
<pre><code>For Manage mode:
       -t, --test
              Unless a more serious error occurred, mdadm will exit with a status of 2 if no changes were made to the array and 0 if at least one change was made.  This can be useful when an indirect specifier such as missing, detached or faulty  is  used  in
              requesting an operation on the array.  --test will report failure if these specifiers didn't find any match.

       -a, --add
              hot-add  listed devices.  If a device appears to have recently been part of the array (possibly it failed or was removed) the device is re-added as described in the next point.  If that fails or the device was never part of the array, the device
              is added as a hot-spare.  If the array is degraded, it will immediately start to rebuild data onto that spare.

              Note that this and the following options are only meaningful on array with redundancy.  They don't apply to RAID0 or Linear.

       --re-add
              re-add a device that was previously removed from an array.  If the metadata on the device reports that it is a member of the array, and the slot that it used is still vacant, then the device will be added back to the array in the same  position.
              This  will normally cause the data for that device to be recovered.  However based on the event count on the device, the recovery may only require sections that are flagged a write-intent bitmap to be recovered or may not require any recovery at
              all.

              When used on an array that has no metadata (i.e. it was built with --build) it will be assumed that bitmap-based recovery is enough to make the device fully consistent with the array.

              When used with v1.x metadata, --re-add can be accompanied by --update=devicesize, --update=bbl, or --update=no-bbl.  See the description of these option when used in Assemble mode for an explanation of their use.

              If the device name given is missing then mdadm will try to find any device that looks like it should be part of the array but isn't and will try to re-add all such devices.

              If the device name given is faulty then mdadm will find all devices in the array that are marked faulty, remove them and attempt to immediately re-add them.  This can be useful if you are certain that the reason for failure has been resolved.

       --add-spare
              Add a device as a spare.  This is similar to --add except that it does not attempt --re-add first.  The device will be added as a spare even if it looks like it could be an recent member of the array.

       -r, --remove
              remove listed devices.  They must not be active.  i.e. they should be failed or spare devices.

              As well as the name of a device file (e.g.  /dev/sda1) the words failed, detached and names like set-A can be given to --remove.  The first causes all failed device to be removed.  The second causes any device which is no longer connected to the
              system (i.e an 'open' returns ENXIO) to be removed.  The third will remove a set as describe below under --fail.

       -f, --fail
              Mark  listed  devices  as  faulty.   As  well as the name of a device file, the word detached or a set name like set-A can be given.  The former will cause any device that has been detached from the system to be marked as failed.  It can then be
              removed.

              For RAID10 arrays where the number of copies evenly divides the number of devices, the devices can be conceptually divided into sets where each set contains a single complete copy of the data on the array.  Sometimes a RAID10 array will be  conâ€
              figured so that these sets are on separate controllers.  In this case all the devices in one set can be failed by giving a name like set-A or set-B to --fail.  The appropriate set names are reported by --detail.

       --set-faulty
              same as --fail.

       --replace
              Mark  listed devices as requiring replacement.  As soon as a spare is available, it will be rebuilt and will replace the marked device.  This is similar to marking a device as faulty, but the device remains in service during the recovery process
              to increase resilience against multiple failures.  When the replacement process finishes, the replaced device will be marked as faulty.
</code></pre><h5 id="æŸ¥çœ‹raidç»„è£…ä¿¡æ¯">æŸ¥çœ‹raidç»„è£…ä¿¡æ¯</h5>
<pre><code>cat /proc/mdstat 
Personalities : [raid10] 
md127 : active raid10 sdc[1] sdd[2] sda[3] sdb[0]
      999950336 blocks super 1.2 512K chunks 2 near-copies [4/4] [UUUU]
      bitmap: 1/8 pages [4KB], 65536KB chunk

unused devices: &lt;none&gt;
</code></pre><p>[UUUU] å¯åŠ¨æ­£å¸¸U up?<br>
S spare<br>
R rebuiding</p>
<h5 id="state-çŠ¶æ€-active-å’Œ-clean-çš„åŒºåˆ«">state çŠ¶æ€ active å’Œ clean çš„åŒºåˆ«</h5>
<p>clean - no pending writes, but otherwise active.
When written to inactive array, starts without resync
If a write request arrives then
if metadata is known, mark &lsquo;dirty&rsquo; and switch to &lsquo;active&rsquo;.
if not known, block and switch to write-pending
If written to an active array that has pending writes, then fails.
active
fully active: IO and resync can be happening.
When written to inactive array, starts with resync</p>
<p><a href="https://www.tecmint.com/category/raid/">æ›´è¿‡è¯¦æƒ…</a></p>
<h4 id="å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†</h4>
<p>åœ¨ç»„è£…è¿‡ç¨‹ä¸­æ„å¤–ä¸­æ–­ï¼Œæœºå™¨é‡å¯ï¼Œå¦‚ä¸‹çŠ¶æ€</p>
<pre><code> State : clean, resyncing (PENDING) 
</code></pre><p>è§£å†³</p>
<pre><code>mdadm --readwrite /dev/md127 
</code></pre>
        </div>

        


        

<div class="post-archive">
    <h2>å…¶ä»–æ–‡ç« </h2>
    <ul class="listing">
        
        <li><a href="/linux/init-centos/">Centos åˆå§‹åŒ–é…ç½®</a></li>
        
        <li><a href="/postgres/template/">æ¨¡æ¿æ•°æ®åº“</a></li>
        
        <li><a href="/postgres/pg_stat_statements/">pg_stat_statements æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯</a></li>
        
    </ul>
</div>



        <div class="post-meta meta-tags">
            
            æ²¡æœ‰æ ‡ç­¾
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "your github repo"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2018 - 2021 <a href="https://zhangeamon.top"> By Eamon</a>
        
    </div>
    <br />
  
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>






    <script src='/js/douban.js'></script>


                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://zhangeamon.top/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://zhangeamon.top">
      <button type="submit" class="submit icon-search"></button>
</form>

    </section>
    
    <section class="widget">
        <h3 class="widget-title">æœ€è¿‘æ–‡ç« </h3>
<ul class="widget-list">
    
    <li>
        <a href="https://zhangeamon.top/redis/pubsub/" title="å‘å¸ƒè®¢é˜…">å‘å¸ƒè®¢é˜…</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/redis/distributedlock/" title="åŸºäºRedis çš„åˆ†å¸ƒå¼é”å®ç°">åŸºäºRedis çš„åˆ†å¸ƒå¼é”å®ç°</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/postgres/libpg/" title="å®¢æˆ·ç«¯æ•…éšœè½¬ç§»">å®¢æˆ·ç«¯æ•…éšœè½¬ç§»</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/postgres/prepare/" title="ä½¿ç”¨prepareé¢„ç¼–è¯‘SQL">ä½¿ç”¨prepareé¢„ç¼–è¯‘SQL</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/postgres/materialized/" title="ç‰©åŒ–è§†å›¾">ç‰©åŒ–è§†å›¾</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/python/requests/" title="Requests">Requests</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/asr/c/" title="C è¯­è¨€ç¯å¢ƒ">C è¯­è¨€ç¯å¢ƒ</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/linux/lightdm/" title="å…³äºUbuntu20.04ä¸‹å‘æ—¥è‘µè¿œç¨‹è½¯ä»¶è¿æ¥ä¸­æ–­çš„è§£å†³æ–¹æ³•">å…³äºUbuntu20.04ä¸‹å‘æ—¥è‘µè¿œç¨‹è½¯ä»¶è¿æ¥ä¸­æ–­çš„è§£å†³æ–¹æ³•</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/linux/so/" title="åŠ¨æ€åº“">åŠ¨æ€åº“</a>
    </li>
    
    <li>
        <a href="https://zhangeamon.top/python/ctypes/" title="python ä¸ C äº¤äº’ç¼–ç¨‹">python ä¸ C äº¤äº’ç¼–ç¨‹</a>
    </li>
    
</ul>

    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories'>åˆ†ç±»</a></h3>
<ul class="widget-list">
    
    <li><a href="https://zhangeamon.top/categories/ansible/">ansible (4)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/etcd/">etcd (1)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/linux/">linux (12)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/mysql/">mysql (1)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/postgres/">postgres (18)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/python/">python (13)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/rabbitmq/">rabbitmq (2)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/redis/">redis (4)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">ä¸­é—´ä»¶ (10)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/%E6%95%B0%E4%BB%93/">æ•°ä»“ (3)</a></li>
    
    <li><a href="https://zhangeamon.top/categories/%E7%9B%91%E6%8E%A7/">ç›‘æ§ (2)</a></li>
    
</ul>

    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags.html'>æ ‡ç­¾</a></h3>
<div class="tagcloud">
    
    <a href="https://zhangeamon.top/tags/%E4%BC%98%E5%8C%96/">ä¼˜åŒ–</a>
    
    <a href="https://zhangeamon.top/tags/%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/">é…ç½®ç®¡ç†</a>
    
    <a href="https://zhangeamon.top/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/">é«˜å¯ç”¨</a>
    
</div>

    </section>

    
<section class="widget">
    <h3 class="widget-title">å‹æƒ…é“¾æ¥</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="http://www.cnblogs.com/zhangeamon" title="å†å²åšå®¢">å†å²åšå®¢</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">å…¶å®ƒ</h3>
        <ul class="widget-list">
            <li><a href="https://zhangeamon.top/index.xml">æ–‡ç«  RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
   
</body>

</html>
